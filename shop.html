<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ç‰¹ç´„å•†åº—è³‡è¨Š</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header>
      <h1 id="shop-title">ç‰¹ç´„å•†åº—è³‡è¨Š</h1>
      <p>è‡ªå‹•å¾ PDF è§£æï¼Œä¾æœ€æ–° GitHub Pages ç‰ˆæœ¬å‘ˆç¾ã€‚</p>
    </header>
    <main>
      <div id="status" class="status">æ­£åœ¨è¼‰å…¥è³‡æ–™â€¦</div>
      <div id="content" style="display: none;">
        <div class="shop-header">
          <div class="pill" id="shop-category"></div>
          <h2 id="shop-name"></h2>
          <div class="meta" id="shop-location"></div>
          <div class="meta" id="shop-phone"></div>
        </div>
        <div class="shop-details">
          <div class="detail">
            <h4>åœ°å€</h4>
            <p id="shop-address"></p>
          </div>
          <div class="detail">
            <h4>å„ªæƒ å…§å®¹</h4>
            <p id="shop-offer"></p>
          </div>
        </div>
        <div class="actions" style="margin-top: 16px;">
          <a class="button" href="./index.html">â† å›å•†åº—æ¸…å–®</a>
        </div>
      </div>
    </main>
    <script type="module">
      import { findShop, loadShops } from "./scripts/data-loader.js";

      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      const statusEl = document.getElementById("status");
      const contentEl = document.getElementById("content");

      function renderShop(shop) {
        document.getElementById("shop-title").textContent = `#${shop.id} ${shop.name}`;
        document.getElementById("shop-name").textContent = `${shop.id}. ${shop.name}`;
        document.getElementById("shop-category").textContent = shop.category;
        document.getElementById("shop-location").textContent = `ğŸ“ ${shop.county} ${shop.district}`;
        document.getElementById("shop-phone").textContent = `ğŸ“ ${shop.phone || "â€”"}`;
        document.getElementById("shop-address").textContent = [shop.county, shop.district, shop.address]
          .filter(Boolean)
          .join(" ");
        document.getElementById("shop-offer").textContent = shop.offer || "â€”";
      }

      loadShops((message) => {
        statusEl.innerHTML = `<strong>${message}</strong>`;
      })
        .then((shops) => {
          const shop = findShop(shops, id);
          if (!shop) {
            statusEl.innerHTML = "æ‰¾ä¸åˆ°æŒ‡å®šçš„åº—å®¶ï¼Œè«‹å›åˆ°åˆ—è¡¨é‡è©¦ã€‚";
            return;
          }
          statusEl.style.display = "none";
          renderShop(shop);
          contentEl.style.display = "block";
        })
        .catch((error) => {
          console.error(error);
          statusEl.innerHTML = "è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†æˆ–ç¢ºèª GitHub Pages ç¶²å€æ˜¯å¦æœ‰ PDFã€‚";
        });
    </script>
  </body>
</html>
