<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æ¡ƒåœ’æ·é‹ç‰¹ç´„å•†åº—æ¸…å–®</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header>
      <h1>æ¡ƒåœ’æ·é‹ç‰¹ç´„å•†åº—æ¸…å–®</h1>
      <p>è‡ªå‹•å¾ PDF è§£æçš„æœ€æ–°åº—å®¶ï¼Œé»æ“Šå³å¯é–‹å•Ÿå°ˆå±¬é é¢ã€‚</p>
    </header>
    <main>
      <div class="toolbar">
        <input id="search" class="input" type="search" placeholder="æœå°‹åº—åã€å€åŸŸæˆ–å„ªæƒ é—œéµå­—â€¦" />
        <div id="status" class="status">æ­£åœ¨è¼‰å…¥è³‡æ–™â€¦</div>
      </div>
      <div id="cards" class="card-grid"></div>
      <div id="empty" class="empty" style="display: none;">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ç‰¹ç´„å•†åº—ã€‚</div>
    </main>
    <script type="module">
      import { loadShops } from "./scripts/data-loader.js";

      const statusEl = document.getElementById("status");
      const cardsEl = document.getElementById("cards");
      const emptyEl = document.getElementById("empty");
      const searchEl = document.getElementById("search");

      function renderShops(shops) {
        cardsEl.innerHTML = "";
        if (!shops.length) {
          emptyEl.style.display = "block";
          return;
        }
        emptyEl.style.display = "none";

        shops.forEach((shop) => {
          const card = document.createElement("article");
          card.className = "card";

          const name = document.createElement("h3");
          name.textContent = `${shop.id}. ${shop.name}`;

          const pill = document.createElement("span");
          pill.className = "pill";
          pill.textContent = shop.category;

          const meta = document.createElement("div");
          meta.className = "meta";
          meta.innerHTML = `
            <div>ğŸ“ ${[shop.county, shop.district, shop.address].filter(Boolean).join(" ")}</div>
            <div>ğŸ“ ${shop.phone || "â€”"}</div>
          `;

          const actions = document.createElement("div");
          actions.className = "actions";
          const link = document.createElement("a");
          link.className = "button primary";
          link.href = \`./shop.html?id=\${shop.id}\`;
          link.textContent = "æŸ¥çœ‹å„ªæƒ ";
          actions.appendChild(link);

          card.appendChild(name);
          card.appendChild(pill);
          card.appendChild(meta);
          if (shop.offer) {
            const offer = document.createElement("div");
            offer.className = "meta";
            offer.textContent = shop.offer.slice(0, 110) + (shop.offer.length > 110 ? "â€¦" : "");
            card.appendChild(offer);
          }
          card.appendChild(actions);
          cardsEl.appendChild(card);
        });
      }

      function applyFilter(shops, keyword) {
        const normalized = keyword.trim();
        if (!normalized) return shops;
        const lower = normalized.toLowerCase();
        return shops.filter((shop) =>
          [shop.name, shop.category, shop.county, shop.district, shop.address, shop.offer]
            .filter(Boolean)
            .some((field) => field.toLowerCase().includes(lower))
        );
      }

      let allShops = [];
      loadShops((message) => {
        statusEl.innerHTML = `<strong>${message}</strong>`;
      })
        .then((shops) => {
          allShops = shops;
          statusEl.style.display = "none";
          renderShops(allShops);
        })
        .catch((error) => {
          console.error(error);
          statusEl.innerHTML = "è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†æˆ–ç¢ºèª GitHub Pages ç¶²å€æ˜¯å¦æœ‰ PDFã€‚";
        });

      searchEl.addEventListener("input", (event) => {
        renderShops(applyFilter(allShops, event.target.value));
      });
    </script>
  </body>
</html>
